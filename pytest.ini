[tool:pytest]
# Test paths and discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test options
addopts = 
    --strict-markers
    --strict-config
    --tb=short
    --disable-warnings
    --durations=10
    --color=yes
    --verbose
    --showlocals
    --maxfail=10
    --asyncio-mode=auto
    --import-mode=importlib
    --basetemp=tests/tmp
    --numprocesses=auto
    --cov=src
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --cov-fail-under=90
    --cov-report=html:htmlcov/bge_m3
    --cov-report=xml:coverage_bge_m3.xml
    --cov-config=.coveragerc
    --cov-context=test

# Custom markers
markers =
    unit: marks tests as unit tests (fast)
    integration: marks tests as integration tests (medium)
    asyncio: marks tests as asyncio tests
    slow: marks tests as slow (deselect with '-m "not slow"')
    mock: marks tests that use mocking
    api: marks tests for API endpoints
    service: marks tests for service layer
    utils: marks tests for utility functions
    pdf: marks PDF extractor tests
    text: marks text preprocessor tests
    embedding: marks embedding service tests
    search: marks search service tests
    vlm: marks VLM service tests
    frontend: marks frontend tests
    performance: marks performance tests
    regression: marks regression tests
    smoke: marks smoke tests
    parametrize: marks tests as parametrized
    benchmark: marks tests as benchmarks
    coverage: marks tests for coverage analysis
    data: marks tests that use mock data
    bge_m3: marks BGE-M3 specific tests
    bge_m3_service: marks BGE-M3 service tests
    bge_m3_utils: marks BGE-M3 utils tests
    bge_m3_search: marks BGE-M3 search tests
    bge_m3_api: marks BGE-M3 API tests
    bge_m3_integration: marks BGE-M3 integration tests
    bge_m3_performance: marks BGE-M3 performance tests
    bge_m3_error: marks BGE-M3 error handling tests

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:torch.*
    ignore::UserWarning:PIL.*
    ignore::UserWarning:pdfplumber.*
    ignore::UserWarning:PyMuPDF.*
    ignore::UserWarning:qdrant_client.*
    ignore::UserWarning:redis.*

# Test data directories
test_data_dir = tests/test_data
bge_m3_test_data_dir = tests/test_data/bge_m3

# Min/requirements for test running
minversion = 6.0
required_plugins = pytest-asyncio, pytest-cov, pytest-mock

# Custom options for BGE-M3 tests
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Performance testing options
benchmark_only = False
benchmark_sort = mean
benchmark_min_rounds = 5
benchmark_max_time = 1.0

# Coverage options
cov_source = src
cov_report_missing = True
cov_report_html = True
cov_report_xml = True
cov_fail_under = 90
cov_branch = True
cov_partial = True
cov_context = test

# Output options
tb_style = short
capture = no
showlocals = True
verbose = True

# Parallel testing
numprocesses = auto